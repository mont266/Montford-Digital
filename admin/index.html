<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager | Montford Digital</title>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <script>
    // Simple Supabase authentication for Decap CMS
    // IMPORTANT: Replace with your actual Supabase URL and Anon Key
    const SUPABASE_URL = 'YOUR_SUPABASE_URL';
    const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY';

    if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || SUPABASE_KEY === 'YOUR_SUPABASE_ANON_KEY') {
      alert('Please configure your Supabase credentials in /admin/index.html');
    }

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const SupabaseAuth = {
      authenticate: (callback) => {
        const loginButton = document.createElement('button');
        loginButton.textContent = 'Login with Supabase (GitHub)';
        loginButton.style.cssText = 'padding: 15px 30px; font-size: 16px; background-color: #3ecf8e; color: white; border: none; border-radius: 5px; cursor: pointer;';
        
        const container = document.createElement('div');
        container.style.cssText = 'display: flex; justify-content: center; align-items: center; height: 100vh;';
        container.appendChild(loginButton);
        document.body.appendChild(container);

        loginButton.addEventListener('click', async () => {
          const { data, error } = await supabase.auth.signInWithOAuth({
            provider: 'github',
            options: {
              scopes: 'repo',
            },
          });
          if (error) {
            console.error('Supabase login error:', error);
            callback(error);
          }
        });

        supabase.auth.onAuthStateChange(async (event, session) => {
          if (event === 'SIGNED_IN' && session) {
            callback(null, { token: session.provider_token, isGitGateway: false });
            container.remove();
          }
        });
      },
      
      getToken: async () => {
        const { data } = await supabase.auth.getSession();
        return data.session?.provider_token || null;
      },

      logout: async () => {
        await supabase.auth.signOut();
        // This will reload the page and show the login button again
        document.location.reload();
      },
    };

    // Register the custom authenticator
    CMS.registerAuthenticator('supabase', SupabaseAuth);

    // Update config to use the custom authenticator
    window.CMS_CONFIG.backend.auth_type = 'custom';
    window.CMS_CONFIG.backend.authenticator = 'supabase';

  </script>
</body>
</html>